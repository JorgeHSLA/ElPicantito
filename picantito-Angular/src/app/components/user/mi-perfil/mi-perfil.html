<!--NAVBAR-->
<header class="position-sticky top-0 z-3">
  <nav class="navbar navbar-expand-lg navbar-light navBarExtra shadow-sm">
    <div class="container">
      <!-- Logo -->
      <a class="navbar-brand d-flex align-items-center" (click)="navigateToHome()" style="cursor: pointer;">
        <img src="assets/images/LogoFont.png" alt="El Picantito Logo" width="200" height="120" class="me-2" />
      </a>
      
      <!-- Buscador Central -->
      <div class="d-none d-lg-flex flex-grow-1 justify-content-center mx-3">
        <form class="search-form-center w-100" style="max-width: 400px;">
          <div class="input-group">
            <input
              class="form-control border-0 rounded-start-pill"
              type="search"
              placeholder="Buscar tacos..."
              aria-label="Search"
              name="search"
            />
            <button class="btn btn-dark rounded-end-pill px-3" type="submit">
              <i class="bi bi-search"></i>
            </button>
          </div>
        </form>
      </div>
      
      <!-- Navegación con iconos -->
      <div class="d-flex align-items-center">
        <ul class="navbar-nav flex-row">
          <li class="nav-item me-2">
            <a class="nav-link icon-nav" (click)="navigateToAbout()" style="cursor: pointer;" 
               data-bs-toggle="tooltip" data-bs-placement="bottom" title="Sobre Nosotros">
              <i class="bi bi-info-circle fs-5"></i>
            </a>
          </li>
          <li class="nav-item me-2">
            <a class="nav-link icon-nav" (click)="navigateToStore()" style="cursor: pointer;" 
               data-bs-toggle="tooltip" data-bs-placement="bottom" title="Menú">
              <i class="bi bi-grid fs-5"></i>
            </a>
          </li>
          <li class="nav-item me-2">
            <a class="nav-link icon-nav" href="#" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Ubicación">
              <i class="bi bi-geo-alt-fill fs-5"></i>
            </a>
          </li>
          <li class="nav-item me-2">
            <a class="nav-link icon-nav" href="#" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Carrito">
              <i class="bi bi-cart3 fs-5"></i>
            </a>
          </li>
          
          <!-- Opciones de usuario - Usuario no logueado -->
          <li class="nav-item dropdown" *ngIf="!loggedUser">
            <a class="nav-link icon-nav dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person fs-5"></i>
            </a>
            <ul class="dropdown-menu dropdown-menu-end user-dropdown-menu" aria-labelledby="userDropdown">
              <li class="dropdown-header">
                <img src="assets/images/LogoMinimalistGrey.png" alt="Logo" style="width:45px;height:45px;object-fit:contain;margin-right:8px;">
                <span>¿Sin Cuenta?</span>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item user-dropdown-item" href="/login">
                  <i class="bi bi-box-arrow-in-right me-2"></i>Iniciar Sesión
                </a>
              </li>
              <li>
                <a class="dropdown-item user-dropdown-item" href="/registry">
                  <i class="bi bi-person-plus me-2"></i>Registrarse
                </a>
              </li>
            </ul>
          </li>
          
          <!-- Opciones de usuario - Usuario logueado -->
          <li class="nav-item dropdown" *ngIf="loggedUser">
            <a class="nav-link icon-nav dropdown-toggle" href="#" id="loggedUserDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person-check fs-5"></i>
            </a>
            <ul class="dropdown-menu dropdown-menu-end user-dropdown-menu" aria-labelledby="loggedUserDropdown">
              <li class="dropdown-header">
                <img src="assets/images/LogoMinimalistGrey.png" alt="Logo" style="width:45px;height:45px;object-fit:contain;margin-right:8px;">
                <span>{{ loggedUser.nombreUsuario }}</span>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item user-dropdown-item" style="cursor: pointer;">
                  <i class="bi bi-person me-2"></i>Mi Perfil
                </a>
              </li>
              <li>
                <a class="dropdown-item user-dropdown-item" href="#">
                  <i class="bi bi-bag me-2"></i>Mis Pedidos
                </a>
              </li>
              <li *ngIf="isAdmin()"><hr class="dropdown-divider"></li>
              <li *ngIf="isAdmin()">
                <a class="dropdown-item user-dropdown-item admin-item" (click)="navigateToAdmin()" style="cursor: pointer;">
                  <i class="bi bi-gear me-2"></i>Panel Administrativo
                </a>
              </li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <a class="dropdown-item user-dropdown-item logout-item" (click)="logout()" style="cursor: pointer;">
                  <i class="bi bi-box-arrow-right me-2"></i>Cerrar Sesión
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>

<!-- CONTENIDO PRINCIPAL -->
<main class="py-5" style="background-color: var(--neutral-bg);">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        
        <!-- Header del perfil -->
        <div class="text-center mb-5">
          <div class="profile-avatar mb-3">
            <img src="assets/images/LogoMinimalist.png" alt="Avatar" class="auth-logo" style="width: 100px; height: 100px;">
          </div>
          <h1 class="h2 mb-2 fw-bold" style="color: var(--neutral-text);">{{ usuario.nombreCompleto }}</h1>
          <p class="text-muted">@{{ usuario.nombreUsuario }}</p>
          <span *ngIf="isAdmin()" class="badge bg-warning text-dark px-3 py-2">
            <i class="bi bi-shield-check me-1"></i>Administrador
          </span>
          <span *ngIf="!isAdmin()" class="badge-primary px-3 py-2 rounded-pill">
            <i class="bi bi-person me-1"></i>Usuario
          </span>
        </div>

        <!-- Mensajes de estado -->
        <div *ngIf="success" class="alert alert-success alert-dismissible fade show mb-4" role="alert">
          <i class="bi bi-check-circle me-2"></i>
          {{ success }}
          <button type="button" class="btn-close" (click)="clearMessages()"></button>
        </div>

        <div *ngIf="error" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
          <i class="bi bi-exclamation-triangle me-2"></i>
          {{ error }}
          <button type="button" class="btn-close" (click)="clearMessages()"></button>
        </div>

        <!-- Tarjetas de información -->
        <div class="row mb-4">
          <div class="col-md-6 mb-3">
            <div class="card profile-card h-100">
              <div class="card-body text-center">
                <i class="bi bi-calendar-plus fs-3 mb-2" style="color: var(--primary-color);"></i>
                <h6 class="card-title fw-semibold">Miembro desde</h6>
                <p class="text-muted mb-0">{{ usuario.fechaRegistro }}</p>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="card profile-card h-100">
              <div class="card-body text-center">
                <i class="bi bi-bag-check fs-3 mb-2" style="color: var(--accent-color);"></i>
                <h6 class="card-title fw-semibold">Pedidos realizados</h6>
                <p class="text-muted mb-0">{{ usuario.pedidosRealizados }} pedidos</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Formulario de edición -->
        <div class="card profile-card mb-4">
          <div class="card-header d-flex align-items-center" style="background-color: var(--primary-color); color: white; border-radius: 13px 13px 0 0;">
            <i class="bi bi-person-gear fs-5 me-2"></i>
            <h5 class="mb-0 fw-bold">Editar Información Personal</h5>
          </div>
          <div class="card-body p-4">
            <form (ngSubmit)="onUpdateProfile()" novalidate>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="nombreCompleto" class="form-label fw-semibold">
                    <i class="bi bi-person me-2" style="color: var(--primary-color);"></i>Nombre Completo
                  </label>
                  <input 
                    type="text" 
                    class="form-control form-control-lg" 
                    id="nombreCompleto" 
                    [(ngModel)]="usuario.nombreCompleto"
                    name="nombreCompleto"
                    required
                    [disabled]="isLoading">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="nombreUsuario" class="form-label fw-semibold">
                    <i class="bi bi-at me-2" style="color: var(--primary-color);"></i>Nombre de Usuario
                  </label>
                  <input 
                    type="text" 
                    class="form-control form-control-lg" 
                    id="nombreUsuario" 
                    [(ngModel)]="usuario.nombreUsuario"
                    name="nombreUsuario"
                    required
                    [disabled]="isLoading">
                </div>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="telefono" class="form-label fw-semibold">
                    <i class="bi bi-telephone me-2" style="color: var(--primary-color);"></i>Teléfono
                  </label>
                  <input 
                    type="tel" 
                    class="form-control form-control-lg" 
                    id="telefono" 
                    [(ngModel)]="usuario.telefono"
                    name="telefono"
                    required
                    [disabled]="isLoading">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="correo" class="form-label fw-semibold">
                    <i class="bi bi-envelope me-2" style="color: var(--primary-color);"></i>Correo Electrónico
                  </label>
                  <input 
                    type="email" 
                    class="form-control form-control-lg" 
                    id="correo" 
                    [(ngModel)]="usuario.correo"
                    name="correo"
                    required
                    [disabled]="isLoading">
                </div>
              </div>
              
              <div class="mb-4">
                <label for="password" class="form-label fw-semibold">
                  <i class="bi bi-lock me-2" style="color: var(--primary-color);"></i>Nueva Contraseña
                </label>
                <input 
                  type="password" 
                  class="form-control form-control-lg" 
                  id="password" 
                  [(ngModel)]="usuario.password"
                  name="password"
                  placeholder="Dejar vacío para mantener la actual"
                  [disabled]="isLoading">
                <div class="form-text">
                  <i class="bi bi-info-circle me-1"></i>
                  Deja este campo vacío si no quieres cambiar tu contraseña
                </div>
              </div>
              
              <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button 
                  type="submit" 
                  class="btn btn-primary btn-lg px-4"
                  [disabled]="isLoading">
                  <span *ngIf="!isLoading">
                    <i class="bi bi-save me-2"></i>Guardar Cambios
                  </span>
                  <span *ngIf="isLoading">
                    <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                    Guardando...
                  </span>
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Zona peligrosa -->
        <div class="card danger-zone">
          <div class="card-header d-flex align-items-center" style="background-color: var(--error-color); color: white; border-radius: 13px 13px 0 0;">
            <i class="bi bi-exclamation-triangle fs-5 me-2"></i>
            <h6 class="mb-0 fw-bold">Zona Peligrosa</h6>
          </div>
          <div class="card-body">
            <p class="text-muted mb-3">
              Una vez que elimines tu cuenta, no hay vuelta atrás. Por favor, asegúrate de que realmente quieres hacer esto.
            </p>
            <button 
              type="button" 
              class="btn btn-danger" 
              (click)="openDeleteModal()"
              [disabled]="isLoading">
              <i class="bi bi-trash me-2"></i>Eliminar Cuenta
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Modal de confirmación para eliminar cuenta -->
<div class="modal fade" id="deleteAccountModal" tabindex="-1" [style.display]="showDeleteModal ? 'block' : 'none'">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title d-flex align-items-center" style="color: var(--error-color);">
          <i class="bi bi-exclamation-triangle me-2"></i>Confirmar Eliminación
        </h5>
        <button type="button" class="btn-close" (click)="closeDeleteModal()"></button>
      </div>
      <div class="modal-body">
        <p class="mb-3">¿Estás seguro de que quieres eliminar tu cuenta?</p>
        <div class="alert alert-warning">
          <i class="bi bi-info-circle me-2"></i>
          <strong>Esta acción no se puede deshacer.</strong> Se eliminarán todos tus datos y no podrás recuperar tu cuenta.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-primary" (click)="closeDeleteModal()" [disabled]="isLoading">
          Cancelar
        </button>
        <button 
          type="button" 
          class="btn btn-danger" 
          (click)="confirmDeleteAccount()"
          [disabled]="isLoading">
          <span *ngIf="!isLoading">
            <i class="bi bi-trash me-2"></i>Sí, Eliminar Cuenta
          </span>
          <span *ngIf="isLoading">
            <span class="spinner-border spinner-border-sm me-2" role="status"></span>
            Eliminando...
          </span>
        </button>
      </div>
    </div>
  </div>
</div>
